///$tab Main
SET ThousandSep=',';
SET DecimalSep='.';
SET MoneyThousandSep=',';
SET MoneyDecimalSep='.';
SET MoneyFormat='$#,##0.00;($#,##0.00)';
SET TimeFormat='h:mm:ss TT';
SET DateFormat='M/D/YYYY';
SET TimestampFormat='M/D/YYYY h:mm:ss[.fff] TT';
SET FirstWeekDay=6;
SET BrokenWeeks=1;
SET ReferenceDay=0;
SET FirstMonthOfYear=1;
SET CollationLocale='en-US';
SET MonthNames='Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec';
SET LongMonthNames='January;February;March;April;May;June;July;August;September;October;November;December';
SET DayNames='Mon;Tue;Wed;Thu;Fri;Sat;Sun';
SET LongDayNames='Monday;Tuesday;Wednesday;Thursday;Friday;Saturday;Sunday';
///$tab Main 2
Sales:
LOAD 
		 chr(64 + Ceil(Rand()*5))	as ID		//Company ID
		,Ceil(Rand()*7)*1000		as SalesAmount	//Amount
		,Date((Ceil(Rand()*1460) + Date('01/01/2014')),'MMM-DD-YYYY')	as CalendarDate	//Date starting Jan 1, 2014
AutoGenerate (3000)
;

CalendarTemp:
LOAD
	 max(CalendarDate)	as DateMax
	,min(CalendarDate)	as DateMin
Resident Sales
;

LET vMaxDate = FieldValue('DateMax',1);
LET vMinDate = FieldValue('DateMin',1)-1;	//Needed to control the minum date autogenerated in Sales table is included in the MasterCalendar

DROP Table CalendarTemp
;

MasterCalendar:
LOAD
	 Date(IterNo() + Date($(vMinDate)))						as CalendarDate
	,num(Date(IterNo() + Date($(vMinDate))))				as CalendarDateNum
	,Week(Date(IterNo() + Date($(vMinDate))))				as CalendarWeek
	,month(Date(IterNo() + Date($(vMinDate))))				as CalendarMonth
	,year(Date(IterNo() + Date($(vMinDate))))				as CalendarYear
	,InYearToDate(Date(IterNo() + Date($(vMinDate))),Date($(vMaxDate)),0)		as YTDFlag
	,InYearToDate(Date(IterNo() + Date($(vMinDate))),Date($(vMaxDate)),-1)		as LYTDFlag
AutoGenerate 1 While Date(IterNo() + Date($(vMinDate))) <= Date($(vMaxDate))
;

LET vYearMax = Year($(vMaxDate));
LET vYearMin = Year($(vMinDate));

FOR i=0 TO $(vYearMax) - $(vYearMin)
	YTDTable:
	LOAD
		 CalendarYear
		,CalendarDate	as YTDDate
		,$(i)* -1 		as YTDOffset
	Resident MasterCalendar
	Where InYearToDate(CalendarDate, Date($(vMaxDate)), $(i)* -1) = -1;
NEXT

LET vStartDate=;
LET vEndDate=;